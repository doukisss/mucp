<?php
//24.0.30.0 TYPE/Serialisation.php GF
//VersionVI: 01F240077f
//(c) 2005-2012 PC SOFT - Release
 define('BALISE_ENTETE','<?xml version="1.0" encoding="'.CHARSET_PAGE.'"?>');define('BALISE_DEBUT_DOCUMENT','<DOCUMENT xmlns:SOAP_ENC="http://schemas.xmlsoap.org/soap/encoding/">'); define('BALISE_FIN_DOCUMENT','</DOCUMENT>'); define('BALISE_INSTANCE_CLASSE','<%1 id="id%2">'); define('BALISE_ELEMENT','<%1>%2</%1>'); define('BALISE_DEBUT_ELEMENT','<%1>'); define('BALISE_FIN_ELEMENT','</%1>'); define('BALISE_ELEMENT_NULL','<%1/>'); define('BALISE_REFERENCE_INSTANCE_CLASSE','<%1 href="#id%2"/>'); define('BALISE_TABLEAU','<%1 SOAP_ENC:arrayType="%1[%2]">'); define('BALISE_CLE_TABLEAU_ASSOC','<key type="%1">%2</key>'); define('BALISE_CLE_TABLEAU_ASSOC_2','<key>%1</key>'); define('TAG_ITEM_TABLEAU','item'); define('TAG_CLE_TABLEAU_ASSOC','key'); define('TAG_VALEUR_TABLEAU_ASSOC','value'); define('TYPE_XML_BOOLEEN','boolean') ; define('TYPE_XML_CHAINE','string'); define('TYPE_XML_ENTIER_4','int') ; define('TYPE_XML_ENTIER_8','long') ; define('TYPE_XML_REEL_8','double'); define('TYPE_XML_DATE','date') ; define('TYPE_XML_HEURE','time'); define('TYPE_XML_DATEHEURE','dateTime'); define('TYPE_XML_DUREE','duration'); define('TYPE_XML_MONETAIRE','pcs:currency'); define('TYPE_XML_ENTIER_U1','unsignedByte'); define('TYPE_XML_ENTIER_U2','unsignedShort'); define('TYPE_XML_ENTIER_U4','unsignedInt'); define('TYPE_XML_ENTIER_U8','unsignedLong'); define('TYPE_XML_ENTIER_1','byte'); define('TYPE_XML_ENTIER_2','short'); define('TYPE_XML_REEL_4','float'); define('TYPE_XML_NUMERIQUE','pcs:decimal'); define('TYPE_XML_ENTIER_UIX','int'); define('TYPE_XML_BUFFER_BIN','base64Binary'); define('TYPE_XML_STRUCTURE','pcs:structure'); define('TYPE_XML_CLASSE','pcs:class'); define('TYPE_XML_CARACTERE','pcs:char'); class WDSerialiseur { var $m_writer = null; var $m_lstReferencesConnues = null; var $m_lstReferencesASerialiser = null; var $m_nNiveauCourant = 0; var $m_bDoubleEncodageChaine=false; function F2aa09a28( &$pclObj ) { $pclObj->F81cf9784($this); return $this->m_writer; } function F0dd88e14( &$pclObj ) { $this->m_writer = ''; $this->F2fa48b0e(BALISE_ENTETE); $this->F2fa48b0e(BALISE_DEBUT_DOCUMENT); $this->Fbc6d6ee7(); $pclObj->F5b70a1d3($this); if (isset($this->m_lstReferencesASerialiser) && ((count($this->m_lstReferencesASerialiser))>0)) { for($ref=reset($this->m_lstReferencesASerialiser); (isset($ref) && $ref !== false); $ref=next($this->m_lstReferencesASerialiser)) { if($ref->Ffe33562a()) { $ref->F5b70a1d3($this); } } } $this->Fd3aab2a5(0); $this->F2fa48b0e(BALISE_FIN_DOCUMENT); $baos = $this->m_writer; if($this->m_writer != null) { $this->m_writer = null; } return $baos; } function F6a6846f4() { if($this->m_nNiveauCourant > 0) { --$this->m_nNiveauCourant; } } function Fbc6d6ee7() { ++$this->m_nNiveauCourant; } function Fd3aab2a5( $nNiveau) { $this->m_nNiveauCourant = max(0,$nNiveau); } function F8bad05bb() { return $this->m_nNiveauCourant; } function F2fa48b0e( $strLigne) { if(isset($this->m_writer)) { for($i=0;$i<$this->m_nNiveauCourant;$i++) { $this->m_writer .= TAB; } $this->m_writer.=$strLigne; $this->m_writer.=RC; } } function F9deb726c( $strTag, &$obj) { if($obj->m_nIsXXX & 64) { if($obj->F6bbd4334()) { $this->F2fa48b0e(FMK_ChaineConstruit(BALISE_ELEMENT_NULL, $strTag)); } else { $strIdRef = $this->Fd3c645ce($obj, true); $this->F2fa48b0e(FMK_ChaineConstruit(BALISE_REFERENCE_INSTANCE_CLASSE, $strTag, $strIdRef)); } } else { if($obj->Ffe33562a()) { $obj->F5b70a1d3($this); } else { $this->F2fa48b0e(FMK_ChaineConstruit(BALISE_ELEMENT,$strTag, $obj->F35be7f7f())); } } } function F22e76fc5( $strTag, &$obj, $bPremier) { $bDoubleEncodage = $this->m_bDoubleEncodageChaine; if ($bDoubleEncodage) { $this->m_bDoubleEncodageChaine = false; } if (!$bPremier) { $this->m_writer .= ','; } if($obj->Ffe33562a()) { if ($strTag!='') { $this->m_writer .= '"'.$strTag . '":'; } if ($bDoubleEncodage) { $tmp = $this->m_writer; $this->m_writer = ''; } $obj->F81cf9784($this); if ($bDoubleEncodage) { $sValeur = '"'.str_replace('"','\\"',$this->m_writer).'"'; $this->m_writer = $tmp . $sValeur; } } else { if ($strTag!='') { $this->m_writer .= '"'.$strTag . '":'; } $sValeur = $obj->F35be7f7f(true); if ($bDoubleEncodage) { $sValeur = '"'.str_replace('"','\\"',$sValeur).'"'; } $this->m_writer .= $sValeur; } } function Fd3c645ce( &$ref, $bASerialiser) { if(!isset($this->m_lstReferencesConnues)) { $this->m_lstReferencesConnues = array(); } else { if (isset($this->m_lstReferencesConnues[$ref->m_sIdentificateur])) return $this->m_lstReferencesConnues[$ref->m_sIdentificateur]; } $ref->m_sIdentificateur = uniqid('AutoDeclare_Ref_SerialisationXML',true); $this->m_lstReferencesConnues[ $ref->m_sIdentificateur ] = count($this->m_lstReferencesConnues,COUNT_NORMAL); if($bASerialiser) { if(!isset($this->m_lstReferencesASerialiser)) { $this->m_lstReferencesASerialiser = array(); } $this->m_lstReferencesASerialiser[$ref->m_sIdentificateur] =& $ref; } return count($this->m_lstReferencesConnues,COUNT_NORMAL) - 1; } } define('TAG_DOCUMENT','DOCUMENT'); define('TAG_ID_INSTANCE','#id'); define('ATT_TYPE_TABLEAU','arrayType'); define('ATT_REF_INSTANCE','href'); define('ATT_TYPE_CLE','type'); class WDDeserialiseur { var $m_lstReferences = array(); var $m_lstPositionXML = array(); var $ms_parseurXML = null; var $m_bConstructionReference=false; var $m_bDoubleEncodageChaine = false; var $m_bUTF8 = false; function WDDeserialiseur() { } function F6733c146( &$obj, $codeJSON ) { DebutErreurAttendue(); $docJSON = json_decode($codeJSON); FinErreurAttendue(); if (!isset($docJSON)) return; $this->F09aa2393($docJSON); $obj->F1b864c68($this,$docJSON); } function F09aa2393(&$docJSON) { $t = is_array($docJSON) ? $docJSON : get_object_vars($docJSON); if (!$t) return; foreach (array_keys($t) as $key) { if(is_array($docJSON) ? array_key_exists($key,$docJSON) : isset($docJSON->$key)) { $sKey = $key; $sKey = str_replace("&", "", $sKey); $sKey = str_replace("?", "", $sKey); $sKey = str_replace(":", "", $sKey); $sKey = str_replace("\\","", $sKey); $sKey = str_replace("/", "", $sKey); $sKey = str_replace("*", "", $sKey); $sKey = str_replace(".", "", $sKey); $sKey = str_replace("'", "", $sKey); $sKey = str_replace("\"","", $sKey); $sKey = str_replace("|", "", $sKey); $sKey = str_replace("%", "", $sKey); $sKey = str_replace("-", "", $sKey); $sKey = str_replace(",", "", $sKey); $sKey = str_replace("!", "", $sKey); $sKey = str_replace("#", "", $sKey); $sKey = str_replace(">", "S", $sKey); $sKey = str_replace("<", "P", $sKey); $sKey = str_replace(" ", "_", $sKey); $sKey = str_replace("\t", "_", $sKey); if ($sKey !== $key) { if (is_array($docJSON)) { $docJSON[$sKey] =& $docJSON[$key]; } else $docJSON->$sKey =& $docJSON->$key; } if (is_array($docJSON)) { if (is_object($docJSON[$sKey]) || is_array($docJSON[$sKey])) $this->F09aa2393($docJSON[$sKey]); else if ($this->m_bDoubleEncodageChaine) { if ((!empty($docJSON[$sKey])&&is_string($docJSON[$sKey])&&$docJSON[$sKey][0]=='"')) { $docJSON[$sKey] = substr($docJSON[$sKey],1,strlen($docJSON[$sKey])-2); } } } else { if (is_object($docJSON->$sKey) || is_array($docJSON->$sKey)) $this->F09aa2393($docJSON->$sKey); else if ($this->m_bDoubleEncodageChaine) { if ((!empty($docJSON->$sKey)&&is_string($docJSON->$sKey)&&substr($docJSON->$sKey,0,1)=='"')) { $docJSON->$sKey = substr($docJSON->$sKey,1,strlen($docJSON->$sKey)-2); } } } } } } function Fc929eb5e( &$obj, $codeXML) { $sNomDoc = 'WDDocXML_Serialisation'; if (!XMLDocument($sNomDoc,$codeXML)) return; $docXML =& Fb9098312($sNomDoc); if(!XMLRacine($sNomDoc) || $docXML->ElementCourant->F74438c68() != TAG_DOCUMENT || $docXML->ElementCourant->Ffb92bfbf() != XML_BALISE || !$docXML->F399fc126()) { XMLTermine($sNomDoc); Fe81a7f9e('ERR_FORMAT_SERIALISATION_INCORRECT'); return; } while($docXML->ElementCourant->Ffb92bfbf() != XML_BALISE) { if(!$docXML->F32669fba()) { XMLTermine($sNomDoc); Fe81a7f9e('ERR_FORMAT_SERIALISATION_INCORRECT'); return; } } $strNomElement = $docXML->ElementCourant->F74438c68(); $nPositionXML = XMLSauvePosition($sNomDoc); $strID = ''; $nCptReference = 0; if($obj->m_nIsXXX & 64) { $strID = TAG_ID_INSTANCE . $nCptReference; ++$nCptReference; } $this->m_lstReferences[$strID] =& $obj; $this->m_lstPositionXML[$strID] = $nPositionXML; while($docXML->F32669fba()) { if($docXML->ElementCourant->Ffb92bfbf() == XML_BALISE) { $strNomElement = $docXML->ElementCourant->F74438c68(); $classe = null; $classe = $strNomElement; $s = $classe; while( (get_parent_class($s) != '') && ($s != get_parent_class($s)) ) { $s = get_parent_class($s); } if(!isset($classe ) || (utf8_strcasecmp($s,'CTypeBase')!==0)) { continue; } $nPositionXML = XMLSauvePosition($sNomDoc); $strID = TAG_ID_INSTANCE . $nCptReference; ++$nCptReference; $this->m_lstReferences[$strID] = new $classe(null); $this->m_lstPositionXML[$strID] = $nPositionXML; } } $tabKeys = array_keys( $this->m_lstReferences ); $nOccurrence = count( $tabKeys ); for($this->m_bConstructionReference = 0; $this->m_bConstructionReference<2; $this->m_bConstructionReference++) for($nKey = 0; $nKey < $nOccurrence; $nKey++) { $strID =& $tabKeys[ $nKey ]; if (empty($strID)) continue; $ref =& $this->m_lstReferences[ $strID ]; $position = $this->m_lstPositionXML[$strID]; if(isset($position)) { XMLRetourPosition($sNomDoc,$position,(!$this->m_bConstructionReference) ? XML_RP_CONSERVE : XML_RP_DEFAUT); $ref->F76c9fb0a($this, $docXML); } } $this->m_bConstructionReference=false; if (isset($this->m_lstPositionXML[''])) { XMLRetourPosition($sNomDoc,$this->m_lstPositionXML['']); $this->m_lstReferences[ '' ]->F76c9fb0a($this, $docXML); } XMLTermine($sNomDoc); unset($sNomDoc); unset($docXML); } function& F7a69eba6( &$docXML) { $obj = null; $sNomDoc = $docXML->F8a7479ce(); $nPositionXML = XMLSauvePosition($sNomDoc); if(XMLRecherche($sNomDoc,ATT_REF_INSTANCE,XML_ATTRIBUT+XML_SOUS_ELEMENT,XML_EXACT)) { $reference =& $this->m_lstReferences[$docXML->ElementCourant->getValeur()]; if(!isset($reference)) { Fe81a7f9e('ERR_FORMAT_SERIALISATION_INCORRECT'); } $obj =& $reference; } else { $obj = $docXML->ElementCourant->getValeur(); } XMLAnnuleRecherche($sNomDoc); XMLRetourPosition($sNomDoc,$nPositionXML); return $obj; } } function F05685153( $strTypeXML) { switch ($strTypeXML) { case (TYPE_XML_BOOLEEN) : { $return = TYPEWL_BOOLEEN; } case ((TYPE_XML_CHAINE)): { $return = TYPEWL_CHAINE; } case ((TYPE_XML_DATE)): { $return = TYPEWL_DATE; } case ((TYPE_XML_DATEHEURE)): { $return = TYPEWL_DATEHEURE; } case ((TYPE_XML_DUREE)): { $return = TYPEWL_DUREE; } case ((TYPE_XML_ENTIER_4)): { $return = TYPEWL_ENTIER; } case ((TYPE_XML_ENTIER_8)): { return 9; } case ((TYPE_XML_HEURE)): { $return = TYPEWL_HEURE; } case ((TYPE_XML_MONETAIRE)): { $return = TYPEWL_MONETAIRE; } case ((TYPE_XML_REEL)): { $return = TYPEWL_REEL; } default: { $return = TYPEWL_CHAINE; } return constant('TYPEVAR_' . $return); } } ?>